const path=window.location.pathname,polseImg=document.getElementById("polse"),resetPolseImg=document.getElementById("resetPolse"),noPolseBigText=document.getElementById("noPolseBigText"),noPolseSmallText=document.getElementById("noPolseSmallText"),polseSrc="./rodpolse6.png",resetSrc="favicon-32x32.png",resetHoverSrc="brokenPolse.png",pathConfig={"/":{bigText:"Big Rød Pølses don’t spin. Unhack and Rød Pølse will spin.",smallText:"Small Rød Pølses don’t spin. Unhack and Rød Pølse will spin."},"/msh/":{bigText:"Big Mads don’t spin. Unhack and Mads will spin.",smallText:"Small Mads don’t spin. Unhack and Mads will spin."}},config=pathConfig[path]||pathConfig["/"];polseImg.src=polseSrc,resetPolseImg.src=resetSrc,noPolseBigText.textContent=config.bigText,noPolseSmallText.textContent=config.smallText,resetPolseImg.addEventListener("mouseover",()=>{resetPolseImg.src=resetHoverSrc}),resetPolseImg.addEventListener("mouseout",()=>{resetPolseImg.src=resetSrc});let savedRotationCount=parseInt(localStorage.getItem("rotationCount"))||0,savedRotationTime=parseFloat(localStorage.getItem("rotationTime"))||0,displayedRotations=0,fastestRotation=null;function updatePolseData(t,e){t!==savedRotationCount&&(localStorage.setItem("rotationCount",t),savedRotationCount=t),(!savedRotationTime||e<savedRotationTime)&&(localStorage.setItem("rotationTime",e),savedRotationTime=e)}function clearPolseData(){localStorage.removeItem("rotationTime"),localStorage.removeItem("rotationCount"),displayedRotations=0,fastestRotation=null,document.getElementById("rotationCount").textContent=displayedRotations,document.getElementById("fastestRotation").textContent="—"}savedRotationCount>0&&savedRotationTime>0&&(displayedRotations=savedRotationCount,fastestRotation=savedRotationTime);const img=document.getElementById("polse");let unpolse=!1;function updatePolse(t,e){unpolse=t,unpolse?(e?document.getElementById("noPolseBig").style.display="block":document.getElementById("noPolseSmall").style.display="block",document.getElementById("rotationDisplay").style.display="none"):(document.getElementById("noPolseBig").style.display="none",document.getElementById("noPolseSmall").style.display="none",document.getElementById("rotationDisplay").style.display="block")}function isMobile(){const t=/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),e=window.matchMedia("(pointer: coarse)").matches;return t||e}function checkZoom(){const t=Math.round(100*window.devicePixelRatio);isMobile()||100===t?updatePolse(!1):updatePolse(!0,t>100)}window.addEventListener("resize",checkZoom),window.addEventListener("load",checkZoom);const resetButton=document.getElementById("resetPolse");resetButton.addEventListener("click",function(){clearPolseData()}),gsap.registerPlugin(Draggable);const image=document.querySelector("#polse");let velocity=.025,rotation=gsap.utils.random(0,360),cumulativeDegrees=0,prevRotation=rotation,lastFullRotationTime=performance.now();function normalizeDelta(t){return(t+180)%360-180}function trackRotation(t){const e=normalizeDelta(t-prevRotation);cumulativeDegrees+=e,prevRotation=t;let o=!1;for(;Math.abs(cumulativeDegrees)>=360;){cumulativeDegrees-=360*Math.sign(cumulativeDegrees),o=!0;const t=performance.now(),e=(t-lastFullRotationTime)/1e3;lastFullRotationTime=t,(!fastestRotation||e<fastestRotation)&&(fastestRotation=e),displayedRotations++}(o||displayedRotations&&fastestRotation)&&(document.getElementById("rotationDisplay").style.display="block"),document.getElementById("rotationCount").textContent=displayedRotations,document.getElementById("fastestRotation").textContent=fastestRotation?fastestRotation.toFixed(4)+"s":"—",updatePolseData(displayedRotations,fastestRotation)}function updateRotation(){unpolse||(rotation+=velocity,gsap.set(image,{rotation}),trackRotation(rotation),velocity*=.9915,Math.abs(velocity)<.001&&(velocity=0))}gsap.ticker.add(updateRotation);let lastAngle=null,center={x:0,y:0};Draggable.create(image,{type:"x,y",onPress(){const t=image.getBoundingClientRect();center.x=t.left+t.width/2,center.y=t.top+t.height/2;const e=this.pointerX-center.x,o=this.pointerY-center.y;lastAngle=Math.atan2(o,e)},onDrag(){const t=this.pointerX-center.x,e=this.pointerY-center.y,o=Math.atan2(e,t);let n=o-lastAngle;n>Math.PI&&(n-=.02*Math.PI),n<-Math.PI&&(n+=.02*Math.PI),unpolse||(velocity+=5*n),lastAngle=o},allowContextMenu:!0});